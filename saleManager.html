<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fuel Sale Tracker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#3f51b5" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f0f2f5;
      color: #333;
    }
    .container {
      max-width: 100%;
      padding: 1rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      margin: 20px auto;
    }
    h2 {
      text-align: center;
      margin-bottom: 1rem;
      color: #3f51b5;
    }
    label {
      margin-top: 10px;
      font-weight: 600;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    button {
      background-color: #3f51b5;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
    }
    button:hover {
      background-color: #303f9f;
    }
    .fuel-inputs {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .totals {
      margin-top: 20px;
      font-size: 1.1rem;
      background: #f7f9fc;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    thead {
      background-color: #e8eaf6;
      position: sticky;
      top: 0;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    .edit-btn {
      background-color: #2196f3;
    }
    .delete-btn {
      background-color: #f44336;
    }
    .action-btn {
      padding: 6px 10px;
      color: white;
      border-radius: 5px;
      margin-right: 5px;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Fuel Sale Tracker</h2>

    <label>Petrol Rate (Rs/L)</label>
    <input type="number" id="petrolRate">

    <label>Diesel Rate (Rs/L)</label>
    <input type="number" id="dieselRate">

    <div class="fuel-inputs">
      <div>
        <label>Petrol (Liters)</label>
        <input type="number" id="petrolLiters">
      </div>
      <div>
        <label>Diesel (Liters)</label>
        <input type="number" id="dieselLiters">
      </div>
    </div>

    <label>Payment Type</label>
    <select id="paymentType" onchange="toggleCustomerFields()">
      <option value="Cash">Cash</option>
      <option value="Credit">Credit</option>
    </select>

    <div id="creditFields" style="display:none">
      <label>Customer Name</label>
      <input type="text" id="customerName">
      <label>Partial Payment</label>
      <input type="number" id="partialPayment">
    </div>

    <button onclick="addTransaction()" id="submitBtn">Add Transaction</button>

    <div class="totals">
      <strong>Total Cash:</strong> Rs <span id="totalCash">0</span><br>
      <strong>Total Credit:</strong> Rs <span id="totalCredit">0</span>
    </div>

    <table>
      <thead>
        <tr>
          <th>Fuel</th>
          <th>Payment</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="transactionTable"></tbody>
    </table>
  </div>

  <script>
    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    let editingIndex = -1;

    function toggleCustomerFields() {
      const type = document.getElementById("paymentType").value;
      document.getElementById("creditFields").style.display = type === "Credit" ? "block" : "none";
    }

    function addTransaction() {
      const petrolRate = parseFloat(document.getElementById("petrolRate").value) || 0;
      const dieselRate = parseFloat(document.getElementById("dieselRate").value) || 0;
      const petrolLiters = parseFloat(document.getElementById("petrolLiters").value) || 0;
      const dieselLiters = parseFloat(document.getElementById("dieselLiters").value) || 0;
      const paymentType = document.getElementById("paymentType").value;
      const customerName = document.getElementById("customerName").value.trim();
      const partialPayment = parseFloat(document.getElementById("partialPayment").value) || 0;

      if (paymentType === "Credit" && customerName === "") {
        alert("Customer name required for credit");
        return;
      }

      const total = (petrolLiters * petrolRate) + (dieselLiters * dieselRate);
      const creditAmount = paymentType === "Credit" ? total - partialPayment : 0;

      const transaction = {
        petrolLiters,
        dieselLiters,
        petrolRate,
        dieselRate,
        total,
        paymentType,
        customerName,
        partialPayment,
        creditAmount
      };

      if (editingIndex > -1) {
        transactions[editingIndex] = transaction;
        editingIndex = -1;
        document.getElementById("submitBtn").innerText = "Add Transaction";
      } else {
        transactions.push(transaction);
      }

      localStorage.setItem("transactions", JSON.stringify(transactions));
      renderTable();
      clearForm();
    }

    function renderTable() {
      const tbody = document.getElementById("transactionTable");
      tbody.innerHTML = "";
      let totalCash = 0, totalCredit = 0;

      transactions.forEach((tx, i) => {
        const fuel = [];
        if (tx.petrolLiters) fuel.push(`Petrol: ${tx.petrolLiters}L @ Rs${tx.petrolRate}`);
        if (tx.dieselLiters) fuel.push(`Diesel: ${tx.dieselLiters}L @ Rs${tx.dieselRate}`);

        const payText = tx.paymentType === "Credit"
          ? `Credit (${tx.customerName})<br>Paid: Rs${tx.partialPayment}<br>Due: Rs${tx.creditAmount}`
          : "Cash";

        if (tx.paymentType === "Cash") totalCash += tx.total;
        else totalCredit += tx.creditAmount;

        tbody.innerHTML += `
          <tr>
            <td>${fuel.join("<br>")}</td>
            <td>${payText}</td>
            <td>Rs ${tx.total.toFixed(2)}</td>
            <td>
              <span class="action-btn edit-btn" onclick="editTransaction(${i})">Edit</span>
              <span class="action-btn delete-btn" onclick="deleteTransaction(${i})">Delete</span>
            </td>
          </tr>
        `;
      });

      document.getElementById("totalCash").innerText = totalCash.toFixed(2);
      document.getElementById("totalCredit").innerText = totalCredit.toFixed(2);
    }

    function editTransaction(index) {
      const tx = transactions[index];
      document.getElementById("petrolLiters").value = tx.petrolLiters;
      document.getElementById("dieselLiters").value = tx.dieselLiters;
      document.getElementById("petrolRate").value = tx.petrolRate;
      document.getElementById("dieselRate").value = tx.dieselRate;
      document.getElementById("paymentType").value = tx.paymentType;
      toggleCustomerFields();
      document.getElementById("customerName").value = tx.customerName;
      document.getElementById("partialPayment").value = tx.partialPayment;
      editingIndex = index;
      document.getElementById("submitBtn").innerText = "Update";
    }

    function deleteTransaction(index) {
      transactions.splice(index, 1);
      localStorage.setItem("transactions", JSON.stringify(transactions));
      renderTable();
    }

    function clearForm() {
      document.getElementById("petrolLiters").value = '';
      document.getElementById("dieselLiters").value = '';
      document.getElementById("partialPayment").value = '';
      document.getElementById("customerName").value = '';
      document.getElementById("paymentType").value = 'Cash';
      toggleCustomerFields();
    }

    toggleCustomerFields();
    renderTable();

    // Service worker for Add to Home Screen
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => {
        console.log("Service Worker Registered");
      });
    }
  </script>
</body>
</html>
